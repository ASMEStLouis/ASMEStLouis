/*! Nova Gallery - HTML5 Multimedia Gallery - 1.2
 * Copyright 2013, Nilok Bose
 * http://codecanyon.net/user/cosmocoder
*/
(function(c,a,b){var d={init:function(f){this.config=f;this.$novaGallery=c("#novaGallery");this.$gallerySets=c("#novaGallerySets");this.$galleryWrapper=c("#novaGalleryWrapper");this.$filterButtons=c("#filterButtons");this.$thumbGrid=c("#novaThumbGrid");this.$captionTest=c('<div id="captionTest"/>').appendTo("body");this.$mask=c('<div id="thumbMask"/>').appendTo(this.$novaGallery);this.$overlayLoader=c('<div id="thumbOverlayLoader"/>').appendTo(this.$novaGallery);this.$overlay=c('<div id="thumbOverlay"/>').appendTo(this.$novaGallery);this.$overlayContent=c('<div id="thumbOverlayContent"/>').appendTo(this.$overlay);this.$close=c('<a class="close"/>').appendTo(this.$overlay);this.$prevItem=c('<a class="prev-item"/>').appendTo(this.$overlay);this.$nextItem=c('<a class="next-item"/>').appendTo(this.$overlay);this.$fullGallery=c("#novaFull");this.$fwmedia=this.$fullGallery.find("div.fwmedia");this.$fwActiveItem=null;this.thumbMeElem=null;this.thumbPlayer=null;this.fwMeElem=null;this.fwplayer=null;this.$fwOverlay=c('<div id="fwOverlay"/>').appendTo(this.$novaGallery);this.$fwOverlayContent=c('<div id="fwOverlayContent"/>').appendTo(this.$fwOverlay);this.displayType=this.options.displayType;this.startMode=this.options.startMode;this.autoplay=this.options.autoplay;this.loop=this.options.loop;this.storeVolume=this.options.storeVolume;this.fwResize=this.options.fullwidthResize;this.fwShowThumbs=this.options.showFullwidthThumbs;this.thumbAppearAnim=this.options.thumbnailsAppearAnimation;this.thumbCaptionAnim=this.options.thumbnailsCaptionAnimation;this.homescreenAnim=this.options.homescreenAnimation;this.preloadNumber=this.options.preloadNumber;this.slideshow=this.options.slideshow;this.pauseTime=this.options.pauseTime;this.fwClock=null;this.volume=null;this.itemnum=0;this.thumbIndex=0;this.fwIndex=0;this.touchStartPos=0;this.touchEndPos=0;this.$window=c(b);this.easing=Modernizr.csstransitions?"in-out":"swing";this.filterSpeed=600;this.fwmediaSpeed=400;this.html5FS=false;this.isChrome=navigator.userAgent.match(/chrome/gi)!==null;this.isSafari=navigator.userAgent.match(/webkit/gi)!==null&&!this.isChrome;this.isOpera=navigator.userAgent.match(/opera/gi)!==null;this.isiOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/gi)!==null;this.isAndroid=navigator.userAgent.match(/android/i)!==null;this.msie=navigator.appName.toLowerCase().indexOf("microsoft")!=-1;this.isIE9=this.msie&&parseFloat(navigator.appVersion.split("MSIE")[1],10)==9;this.ie9js=this.msie&&b.IE7&&IE7.recalc?true:false;this.hasTouch="ontouchstart" in b;this.$overlayContent.html('<div class="details"><h2></h2><p></p></div>');this.$otitle=this.$overlayContent.find("h2");this.$odescription=this.$overlayContent.find("p");this.$fwOverlay.append('<a class="close"/>');Modernizr.csstransforms3d&&this.thumbCaptionAnim==="flip"?this.$thumbGrid.addClass("css3d"):(this.thumbCaptionAnim="fade");!Modernizr.csstransforms3d&&this.thumbAppearAnim==="flipSeq"?this.thumbAppearAnim="fadeSeq":this.thumbAppearAnim;!Modernizr.csstransitions&&(c.fn.transition=c.fn.animate);if(a.documentElement.requestFullScreen||a.documentElement.mozRequestFullScreen||a.documentElement.webkitRequestFullScreen){this.html5FS=true;c("#goFullscreen").show()}if(!this.hasTouch){this.$filterButtons.addClass("no-touch");this.$thumbGrid.addClass("no-touch");this.$novaGallery.find("menu").addClass("no-touch")}if(f.find("gallery").length!==0){var e=this;this.createGallerySets(f);this.$gallerySets.addClass("hidden");this.$gallerySets.imagesLoaded(function(){e.$gallerySets.removeClass("hidden");e.$novaGallery.css({background:"none",height:"auto"});e.$gallerySets.fadeIn(400,function(){if(b.PIE){e.$gallerySets.find("img, span.number").each(function(){b.PIE.attach(this)})}})})}else{c("#gotoSets").hide();this.$galleryWrapper.show();this.showGallery()}this.bindEvents()},loadConfig:function(e){c.ajax({type:"GET",url:e,dataType:"xml",global:false,success:function(j){if(d.options.useVimeoThumbs){var g=c(j),h=[],f,i;g.find('file[type="video"]').find("source").filter(function(){return c(this).text().indexOf("vimeo")!==-1}).each(function(){var k=c(this);f=k.text().split("/").pop();i=c.ajax({url:"http://vimeo.com/api/v2/video/"+f+".json",dataType:"jsonp",success:function(m){var l=j.createElement("thumbnail");l.appendChild(j.createTextNode(m[0].thumbnail_medium));k.before(l)}});h.push(i)});c.when.apply(c,h).done(function(){d.init(g)})}else{d.init(c(j))}}})},loadFlickrData:function(i){var g=d,e="url_"+i.thumbSize,j="url_"+i.imageSize,k="",h="http://api.flickr.com/services/rest/?method=flickr.photos.search&api_key="+i.apiKey+"&per_page="+i.limit+"&sort="+i.sort+"&extras=url_t,url_m,url_o,url_s,url_q,url_l,url_z,description";if(i.sourceType==="user"){h+="&user_id="+i.sourceId;k="flickr-user-"+i.sourceId}else{if(i.sourceType==="group"){h+="&group_id="+i.sourceId;k="flickr-group-"+i.sourceId}else{if(i.sourceType==="set"){h="http://api.flickr.com/services/rest/?&method=flickr.photosets.getPhotos&api_key="+i.apiKey+"&photoset_id="+i.sourceId+"&per_page="+i.limit+"&sort="+i.sort+"&extras=url_t,url_m,url_o,url_s,url_q,url_l,url_z,description";k="flickr-set-"+i.sourceId}else{if(i.sourceType==="tags"){h+="&tags="+i.sourceId;k="flickr-tags-"+i.sourceId}else{if(i.sourceType==="text"){h+="&text="+i.sourceId;k="flickr-text-"+i.sourceId}}}}}if(g.options.enableCache){var f=g.getCache(k)}else{var f=c.Deferred();f.resolve()}f.done(function(l){var m=c(l);if(l&&m.find("novaGallery").attr("status")!=="expired"){d.init(m)}else{c.ajax({url:h,dataType:"xml",global:false,success:function(q){var o=c(q),n="<novagallery>",p,r="";if(o.find("rsp").attr("stat")==="ok"&&o.find("photos").attr("total")!=="0"){r=g.createFlickrSetXML(o.find("photo"),j,e);n+=r+"</novagallery>";p=c(c.parseXML(n));d.options.enableCache&&d.updateCache(n,k);d.init(p)}else{if(o.find("photos").attr("total")==="0"){g.ngLog("Flickr: No photos found")}else{g.ngLog("Flickr: "+o.find("err").attr("msg"))}}}})}})},loadFlickrCollection:function(j){var i=d,g="url_"+j.thumbSize,k="url_"+j.imageSize,l="flickr-collection"+j.sourceId+"-user-"+j.userId,e="http://api.flickr.com/services/rest/?method=flickr.collections.getTree&api_key="+j.apiKey,f="http://api.flickr.com/services/rest/?&method=flickr.photosets.getPhotos&api_key="+j.apiKey+"&per_page="+j.limit+"&sort="+j.sort+"&extras=url_t,url_m,url_o,url_s,url_q,url_l,url_z,description";if(j.sourceId!==""){e+="&collection_id="+j.sourceId}if(j.userId!==""){e+="&user_id="+j.userId}if(i.options.enableCache){var h=i.getCache(l)}else{var h=c.Deferred();h.resolve()}h.done(function(m){var n=c(m);if(m&&n.find("novaGallery").attr("status")!=="expired"){d.init(n)}else{c.ajax({url:e,dataType:"xml",global:false,success:function(q){var o=c(q),r=[],p=[];if(o.find("rsp").attr("stat")==="ok"){o.find("set").each(function(){var t=c(this).attr("id"),s=c(this).attr("title"),u=c.ajax({url:f+"&photoset_id="+t,dataType:"xml",success:function(y){var w=c(y),v='<gallery title="'+s+'">',x,z="";if(w.find("rsp").attr("stat")==="ok"){z=i.createFlickrSetXML(w.find("photo"),k,g);v+=z+"</gallery>";p.push(v)}else{i.ngLog("Flickr: "+w.find("err").attr("msg"))}}});r.push(u)})}else{i.ngLog("Flickr: "+o.find("err").attr("msg"))}c.when.apply(c,r).done(function(){var s="<novagallery>"+p.join("")+"</novagallery>",t=c(c.parseXML(s));d.options.enableCache&&d.updateCache(s,l);d.init(t)})}})}})},createFlickrSetXML:function(g,i,f){var h,e,j="";g.each(function(){e=c(this);h=e.attr(i)?e.attr(i):e.attr("url_o");h=h?h:e.attr("url_z");h=h?h:e.attr("url_m");j+='<file type="photo">';j+="<thumbnail>"+e.attr(f)+"</thumbnail>";j+="<source>"+h+"</source>";j+="<title><![CDATA["+e.attr("title")+"]]></title>";j+="<description><![CDATA["+e.find("description").text()+"]]></description>";j+="</file>"});return j},loadPicasaData:function(h){var g=d,e="",j="",k="",i="https://picasaweb.google.com/data/feed/api/";if(h.sourceType==="search"){i+="all?q="+h.search+"&callback=?";k="picasa-search-"+h.search}else{if(h.sourceType==="user"){i+="user/"+h.username+"?&callback=?";k="picasa-user-"+h.username}else{if(h.sourceType==="album"){i+="user/"+h.username+"/album/"+h.album+"?&callback=?";k="picasa-album-"+h.album+"-user-"+h.username}else{if(h.sourceType==="collection"){i+="user/"+h.username+"?&callback=?";k="picasa-collection-user-"+h.username}}}}if(g.options.enableCache){var f=g.getCache(k)}else{var f=c.Deferred();f.resolve()}f.done(function(l){var m=c(l);if(l&&m.find("novaGallery").attr("status")!=="expired"){d.init(m)}else{c.ajax({url:i,data:{kind:h.sourceType==="collection"?"album":"photo",access:"public","max-results":h.sourceType==="collection"?100:h.limit,thumbsize:h.thumbSize+"u",imgmax:h.imageSize+"u",fields:h.sourceType==="collection"?"entry(title,gphoto:name,gphoto:numphotos)":"entry(media:group(media:content,media:thumbnail,media:title,media:description))",alt:"json"},dataType:"json",timeout:5000,global:false,success:function(q){if(!q.feed.entry){g.ngLog("Picasa request failed");return}var n="<novagallery>",o,s="",r=[],p;if(h.sourceType==="collection"){c.each(q.feed.entry,function(){if(this.gphoto$numphotos.$t===0){return}var t=this;p=c.ajax({url:"https://picasaweb.google.com/data/feed/api/user/"+h.username+"/album/"+this.gphoto$name.$t+"?&callback=?",data:{kind:"photo",access:"public","max-results":h.limit,thumbsize:h.thumbSize+"u",imgmax:h.imageSize+"u",fields:"entry(media:group(media:content,media:thumbnail,media:title,media:description))",alt:"json"},dataType:"json",global:false,success:function(u){s+='<gallery title="'+t.title.$t+'">';c.each(u.feed.entry,function(){s+='<file type="photo">';s+="<thumbnail>"+this.media$group.media$thumbnail[0].url+"</thumbnail>";s+="<source>"+this.media$group.media$content[0].url+"</source>";s+="<title><![CDATA["+this.media$group.media$title.$t+"]]></title>";s+="<description><![CDATA["+this.media$group.media$description.$t+"]]></description>";s+="</file>"});s+="</gallery>"}});r.push(p)})}else{c.each(q.feed.entry,function(){s+='<file type="photo">';s+="<thumbnail>"+this.media$group.media$thumbnail[0].url+"</thumbnail>";s+="<source>"+this.media$group.media$content[0].url+"</source>";s+="<title><![CDATA["+this.media$group.media$title.$t+"]]></title>";s+="<description><![CDATA["+this.media$group.media$description.$t+"]]></description>";s+="</file>"})}c.when.apply(c,r).done(function(){n+=s+"</novagallery>";o=c(c.parseXML(n));d.options.enableCache&&d.updateCache(n,k);d.init(o)})},complete:function(p,n){var o="";if(p.status===0){if(h.sourceType==="user"){o+="user not found"}else{if(h.sourceType==="album"){o+="user or album not found"}}o="Picasa request failed"+(o?": "+o:".");g.ngLog(o)}}})}})},getCache:function(f){var e=c.ajax({data:{cacheId:f,interval:d.options.cacheInterval},url:d.options.cacheFolder+"/get-cache.php",dataType:"xml",global:false});return e},updateCache:function(e,f){c.ajax({type:"post",data:{config:e,cacheId:f},url:d.options.cacheFolder+"/update-cache.php",dataType:"xml",global:false})},createGallerySets:function(j){var g=d,k=j.find("gallery"),e=k.length,l="",f;for(var h=0;h<e;h++){f=k.eq(h).attr("thumbnail");!f&&(f=k.eq(h).find("thumbnail").eq(0).text());l+="<li>";l+="<figure>";l+='<img src="'+f+'">';l+="<figcaption>";l+='<span class="title">'+k.eq(h).attr("title")+"</span>";l+='<span class="number">'+k.eq(h).children().length+"</span>";l+="</figcaption>";l+="</figure>";l+="</li>"}g.$gallerySets.children("ul").html(l)},getGallery:function(){var f=d,e=f.$gallerySets.find("li").index(c(this).closest("li"));f.$novaGallery.height(f.$novaGallery.height());f.fwMeElem=null;f.fwplayer=null;b.mejs.players=[];if(Modernizr.csstransitions&&f.homescreenAnim==="scale"){f.$novaGallery.css("overflow","hidden");f.$gallerySets.addClass("scale scaleDown").on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){f.$novaGallery.css("overflow","");f.$gallerySets.removeClass("scale scaleUp").hide().off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd");f.$galleryWrapper.addClass("loading").fadeIn(600,function(){f.showGallery(e)})});f.$gallerySets.redraw().addClass("scaleUp").removeClass("scaleDown")}else{if(f.homescreenAnim==="slide"){f.$novaGallery.css("overflow","hidden");f.$gallerySets.addClass("slide").transition({top:-f.$novaGallery.height()},600,f.easing,function(){f.$gallerySets.removeClass("slide").css({top:"",display:"none"});f.$novaGallery.css("overflow","");f.$galleryWrapper.addClass("loading").fadeIn(600,function(){f.showGallery(e)})})}else{f.$gallerySets.fadeOut(600,function(){f.$galleryWrapper.addClass("loading").fadeIn(600,function(){f.showGallery(e)})})}}},showGallery:function(e){var f=d,g=e!==undefined?f.config.find("gallery").eq(e):f.config;f.$thumbGrid.add(f.$fullGallery).addClass("hidden");f.createGallery(g);f.fwmediaSpeed=0;f.setFWItem.call(f.$fullGallery.find("li")[0]);f.fwmediaSpeed=400;f.$novaGallery.imagesLoaded(function(){f.setThumbGrid();f.$fwmedia.show();f.$novaGallery.parent().addClass("parentHideOverflow");f.setFullwidthSize();f.$novaGallery.parent().removeClass("parentHideOverflow");f.fwShowThumbs&&f.showFullwidthThumbs.call(f.$fullGallery.find("a.showThumbs")[0]);f.$thumbGrid.add(f.$fullGallery).removeClass("hidden");f.$galleryWrapper.removeClass("loading");f.$novaGallery.css({background:"none",height:"auto"});f.ie9js&&IE7.recalc();if(f.startMode==="fullwidth"){f.$fullGallery.fadeIn(400);f.$novaGallery.find('a[data-mode="fullwidth"]').addClass("active").siblings().removeClass("active")}else{if(f.thumbAppearAnim==="flipSeq"||f.thumbAppearAnim==="slideSeq"||f.thumbAppearAnim==="fadeSeq"){f.$thumbGrid.find("ul").addClass("play "+f.thumbAppearAnim);if(Modernizr.cssanimations){f.$thumbGrid.find("li").last().on("animationend webkitAnimationEnd oanimationend MSAnimationEnd",function(){c(this).parent().removeClass("play "+f.thumbAppearAnim).end().off("animationend webkitAnimationEnd oanimationend MSAnimationEnd")})}else{f.$thumbGrid.find("li.filtered").each(function(h){c(this).delay(h*200).css({opacity:0,marginTop:f.thumbAppearAnim==="slideSeq"?"-30px":0}).animate({opacity:1,marginTop:0},800,"linear")})}f.$thumbGrid.show()}else{if(f.thumbAppearAnim==="slide"){f.$thumbGrid.css({marginTop:"-30px",display:"block",opacity:0}).animate({marginTop:0,opacity:1},600)}else{f.$thumbGrid.fadeIn(600)}}f.$novaGallery.find('a[data-mode="thumbnails"]').addClass("active").siblings().removeClass("active")}f.slideshow&&f.FWSlideshow.call(f.$fullGallery.find("a.slideshow")[0])})},createGallery:function(g){var v=d;v.$files=g.find("file");v.itemnum=v.$files.length;if(v.options.shuffleItems){v.$files=c(v.shuffle(v.$files.get()))}var h=v.$files.children("title"),l=v.$files.children("description"),p,n,m="",q="";for(var k=0;k<v.itemnum;k++){p=v.$files.eq(k).find("category");n='{"category": false}';if(p.length!==0){n="{";p.each(function(){n+='"'+c(this).text()+'": true,'});n=n.substr(0,n.length-1);n+="}"}var j=v.$files.eq(k),r=j.attr("type"),f=j.find("source"),e=j.find("thumbnail").text(),s=v.$files.eq(k).find("link").text(),o=s?" linkItem":"",t="";if(r==="video"){if(v.options.useYoutubeThumbs&&f.text().indexOf("youtube")!==-1){var u=f.text().split("v=")[1];e="http://img.youtube.com/vi/"+u+"/mqdefault.jpg"}}if(s){if(v.options.newWindowLinks){t='<a class="link" href="'+s+'" target="_blank"></a>'}else{t='<a class="link" href="'+s+'"></a>'}}m+='<li class="filtered'+o+'" data-id="'+k+'" data-type="'+r+"\" data-categories='"+n+"'>";m+="<figure>";m+='<img src="'+e+'" alt="" />';m+="<figcaption>";m+="<h2>"+h.eq(k).text()+"</h2>";m+='<div class="details">'+l.eq(k).text()+"</div>";m+="</figcaption>";m+="</figure>";m+='<div class="hoverTitle">'+h.eq(k).text()+"</div>";m+='<a class="showInfo"></a>';m+='<a class="showOverlay"></a>';m+=t;q+='<li class="filtered" data-id="'+k+'" data-type="'+r+"\" data-categories='"+n+"'>";q+='<img src="'+e+'" alt="" />';q+="</li>"}v.$thumbGrid.find("ul").html(m);v.$fullGallery.find("ul").html(q);if(v.fwResize){v.$fullGallery.find("a.resize").addClass("collapsed")}},setThumbGrid:function(){var o=this,l=o.$thumbGrid.children("ul"),h=o.$thumbGrid.find("figure > img"),g=h.length,j=0,n=0,e;for(var k=0;k<g;k++){k===0&&(j=h[k].width);h[k].width<j&&(j=h[k].width)}for(var k=0;k<g;k++){e=j*Math.floor(h[k].width/j);h[k].width=e;h.eq(k).parent().add(h.eq(k).closest("li")).css({width:e,height:h[k].height})}if(l.hasClass("masonry")){l.masonry("destroy")}var m=l.children("li").eq(0),f=j+parseInt(m.css("marginRight"),10)+parseInt(m.css("marginLeft"),10);o.filterSpeed=0;o.$thumbGrid.addClass("setCategory");l.masonry({isAnimated:!Modernizr.csstransitions,animationOptions:{duration:600,easing:"swing",queue:false},isFitWidth:true,columnWidth:f,itemSelector:".filtered"});l.masonry("option","duration",o.filterSpeed);o.handleMenu.call(c("#filterButtons").find("a.startCategory")[0]);o.$thumbGrid.removeClass("setCategory");o.filterSpeed=600;l.masonry("option","duration",o.filterSpeed);if(Modernizr.cssanimations){l.find("li.filtered").each(function(p){c(this).css({"-webkit-animation-delay":p*200+"ms","-moz-animation-delay":p*200+"ms","-o-animation-delay":p*200+"ms","-ms-animation-delay":p*200+"ms","animation-delay":p*200+"ms"})})}},shuffle:function(f){for(var g,e,h=f.length;h;g=parseInt(Math.random()*h,10),e=f[--h],f[h]=f[g],f[g]=e){}return f},bindEvents:function(){this.$novaGallery.find("menu").on("click","a",this.handleMenu);this.$novaGallery.find("menu").on("touchstart",function(g){g.stopPropagation();c(this).addClass("hover")});this.$filterButtons.on("touchstart",function(g){g.stopPropagation();d.$filterButtons.addClass("hover")});c(a).on("touchstart",function(g){d.$filterButtons.removeClass("hover").closest("menu").removeClass("hover")});this.$gallerySets.on("click","img",this.getGallery);this.$thumbGrid.on("touchstart","li",function(){c(this).addClass("hover").siblings().removeClass("hover")});this.$thumbGrid.on("click","a.showInfo",this.thumbGridCaptions);this.$thumbGrid.on("click","a.showOverlay",this.overlayCreate);this.$prevItem.click(this.overlayPrev);this.$nextItem.click(this.overlayNext);this.$close.click(this.overlayClose);this.$window.on("resize orientationchange mozfullscreenchange webkitfullscreenchange",this.setFullwidthSize);this.$fullGallery.find("a.showThumbs").click(this.showFullwidthThumbs);this.$fullGallery.on("click","li",this.setFWItem);this.$fullGallery.find("a.slide-next").click(this.thumbnailsSlideNext);this.$fullGallery.find("a.slide-prev").click(this.thumbnailsSlidePrev);this.$fullGallery.find("ul").on("touchstart touchmove touchend",this.touchSlide);this.$fullGallery.find("a.slideshow").click(this.FWSlideshow);this.$fullGallery.find("a.next").click(this.showNextFWItem);this.$fullGallery.find("a.prev").click(this.showPrevFWItem);this.$fullGallery.find("a.info").click(this.showFWCaption);this.$fwOverlay.find("a.close").click(this.closeFWCaption);this.$fullGallery.find("a.resize").click(this.resizeFWItem);if(this.html5FS){c(a).on("click","div.mejs-fullscreen-button",this.nativeMEFS)}if(this.isOpera){this.$fwmedia.on("click","div.mejs-fullscreen-button",this.operaMEFS);c(a).keydown(this.operaEscPlayerFS)}c(a).keydown(this.handleKeys);var f=this.getHiddenProp();if(f){var e=f.replace(/[H|h]idden/,"")+"visibilitychange";a.addEventListener(e,this.pageVisChange)}},thumbGridCaptions:function(){var s=d,n=c(this),o=n.parent(),g=o.children("figure"),l=o.find("figcaption"),f=o.find("img"),i=o.children("div.hoverTitle"),p=0,r=s.displayType==="container"?s.$novaGallery.parent():s.$window,h=f[0].width,q=f[0].height,j=h,e=q,k=600,m=600;s.$captionTest.empty().html(l.html());j=parseInt(s.$captionTest.css("width"),10);e=parseInt(s.$captionTest.css("height"),10);j<h&&(j=h);e<q&&(e=q);p=j>h?(h-j):p;m=j===h&&e===q?0:m;o.data("expansionDuration",m);s.closeThumbCaption(o.siblings("li.captionOn"));if(!o.hasClass("captionOn")){o.addClass("captionOn");if(o.offset().left+j>r.width()){g.add(l).removeClass("fixedLeft").addClass("fixedRight");p=0}else{g.add(l).removeClass("fixedRight").addClass("fixedLeft")}n.addClass("hidden").css("right",p);i.addClass("hidden");if(s.thumbCaptionAnim==="flip"){o.addClass("flip");setTimeout(function(){g.addClass("hideOverflow");g.add(l).css({width:j,height:e});setTimeout(function(){n.removeClass("hidden");l.css("overflow","auto")},m)},k)}else{g.addClass("hideOverflow");f.fadeOut(600);l.css({width:j,height:e}).fadeIn(600);g.transition({width:j,height:e},m,s.easing);n.removeClass("hidden");l.css("overflow","auto")}}else{s.closeThumbCaption(o)}},closeThumbCaption:function(f){if(f.length===0){return false}var g=f.children("figure"),k=g.children("figcaption"),h=f.find("img"),e=f.children("a.showInfo"),j=f.children("div.hoverTitle"),i=f.data("expansionDuration");e.addClass("hidden").css("right","0");k.css("overflow","");if(d.thumbCaptionAnim==="flip"){g.css({width:h[0].width,height:h[0].height});setTimeout(function(){g.removeClass("hideOverflow");g.children("figcaption").css({width:h[0].width,height:h[0].height});f.redraw().removeClass("captionOn flip");setTimeout(function(){e.add(j).removeClass("hidden")},600)},i)}else{g.transition({width:h[0].width,height:h[0].height},i,self.easing);g.children("figcaption").fadeOut(600);h.fadeIn(600,function(){f.removeClass("captionOn");e.add(j).removeClass("hidden")})}},handleMenu:function(){var m=d,i=c(this),l=m.$galleryWrapper.children("div.displayStyle"),n=m.$thumbGrid.find("li"),k=m.$fullGallery.find("li"),g=i.data("mode"),j=i.data("type"),e=i.data("category");if(this.id==="gotoSets"){i.removeClass("active");m.fwMeElem&&m.fwMeElem.pause();if(Modernizr.csstransitions&&m.homescreenAnim==="scale"){m.$novaGallery.css({height:m.$novaGallery.height(),overflow:"hidden"});m.$galleryWrapper.addClass("scale scaleUp");m.$gallerySets.addClass("scale scaleUp").show();m.$galleryWrapper.add(m.$gallerySets).redraw().removeClass("scaleUp").addClass("scaleDown");m.$gallerySets.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){m.$galleryWrapper.hide().add(m.$gallerySets).removeClass("scale scaleDown");m.$novaGallery.css({height:"auto",overflow:""});l.hide();m.$novaGallery.find("menu a").removeClass("active");m.$gallerySets.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd")})}else{if(m.homescreenAnim==="slide"){m.$novaGallery.css({height:m.$novaGallery.height(),overflow:"hidden"});m.$gallerySets.addClass("slide").css({display:"block",top:-m.$novaGallery.height()});m.$galleryWrapper.fadeOut(600,function(){m.$gallerySets.transition({top:0},600,m.easing,function(){m.$gallerySets.removeClass("slide");m.$novaGallery.css({height:"auto",overflow:""})});l.hide();m.$novaGallery.find("menu a").removeClass("active")})}else{m.$galleryWrapper.fadeOut(600,function(){m.$gallerySets.fadeIn(600);l.hide();m.$novaGallery.find("menu a").removeClass("active")})}}}else{if(this.id==="goFullscreen"){if((a.fullScreenElement&&a.fullScreenElement!==null)||(!a.mozFullScreenElement&&!a.webkitIsFullScreen)){if(m.$novaGallery[0].requestFullScreen){m.$novaGallery[0].requestFullScreen()}else{if(m.$novaGallery[0].mozRequestFullScreen){m.$novaGallery[0].mozRequestFullScreen()}else{if(m.$novaGallery[0].webkitRequestFullScreen){m.$novaGallery[0].webkitRequestFullScreen()}}}}else{if(a.cancelFullScreen){a.cancelFullScreen()}else{if(a.mozCancelFullScreen){a.mozCancelFullScreen()}else{if(a.webkitCancelFullScreen){a.webkitCancelFullScreen()}}}}}else{if(i.closest("#filterButtons").length!==0){if(i.hasClass("top")){return}var h,f;i.closest("ul").find("a").removeClass("active");i.addClass("active");if(j){if(j==="all"){h=n;f=k}else{h=n.filter("[data-type="+j+"]");f=k.filter("[data-type="+j+"]")}}else{if(e){h=n.filter(function(){if(e in c(this).data("categories")){return true}});f=k.filter(function(){if(e in c(this).data("categories")){return true}})}}m.$thumbGrid.css("overflow","hidden");n.not(h).redraw().removeClass("filtered");h.addClass("filtered");m.$thumbGrid.children("ul").masonry("reload");if(!Modernizr.csstransitions){n.not(h).animate({opacity:0},m.filterSpeed,function(){c(this).hide();m.$thumbGrid.css("overflow","")});h.show().animate({opacity:1},m.filterSpeed)}else{m.$thumbGrid.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){m.$thumbGrid.css("overflow","").off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd")})}m.$fullGallery.find("ul").fadeOut(m.filterSpeed,function(){k.filter("li.filtered").eq(0).css("margin-left","0");k.removeClass("filtered").hide();f.addClass("filtered").show();c(this).fadeIn(m.filterSpeed);if(!m.$fwActiveItem.hasClass("filtered")){f.eq(0).trigger("click")}else{var q=f.length,p=f.index(m.$fwActiveItem);m.$fullGallery.find("p.slide-number").text((p+1)+"/"+q);m.fwIndex=p}m.setThumbnailsSlider()})}else{var o=l.filter('[data-display="'+g+'"]');i.addClass("active").siblings().removeClass("active");if(o.is(":hidden")){if(g==="fullwidth"){m.$fullGallery.addClass("hidden");m.$novaGallery.parent().addClass("parentHideOverflow");m.setFullwidthSize();m.$novaGallery.parent().removeClass("parentHideOverflow");m.$fullGallery.removeClass("hidden")}else{m.fwMeElem&&m.fwMeElem.pause()}l.filter(":visible").fadeOut(600,function(){o.fadeIn(600,function(){if(g==="fullwidth"&&m.$fwmedia.data("type")!=="photo"){if(m.fwMeElem.pluginType!=="youtube"&&m.fwMeElem.pluginType!=="vimeo"){m.fwplayer.setControlsSize()}}})})}}}}},overlayCreate:function(){var i=d,h=c(this).parent(),k=h.data("type"),g=h.data("id"),f=i.$thumbGrid.find("li.filtered").index(h),e=i.$files.eq(g),j=e.find("source");i.thumbIndex=f;i.$otitle[0].innerHTML=e.find("title").text();i.$odescription[0].innerHTML=e.find("description").text();var l=i.$window.height()/2;i.$mask.css({height:c(a).height(),width:c(a).width()}).fadeIn(400,function(){i.$overlayLoader.css("top",l).show();if(k==="photo"){if(i.msie){i.$overlay.css({visibility:"hidden",display:"block"});i.$overlayContent.css({visibility:"hidden",display:"block"})}var p=c('<img src="'+j.text()+'" alt="" />').appendTo(i.$overlayContent);p[0].onload=function(){i.resizeImage(p[0],"thumbnails");var C=p[0].width,D=p[0].height;C=C<300?300:C;if(i.msie){i.$overlay.css({visibility:"visible",display:"none"});i.$overlayContent.css({visibility:"visible",display:"none"})}i.overlayShow(C,D,l)}}else{if(k==="audio"){var s="<audio controls>",z="<audio controls";for(var t=0,v=j.length;t<v;t++){var q=j.eq(t).text(),B=q.split(".").pop();if(B==="ogg"){s+='<source type="audio/ogg" src="'+q+'" />'}else{if(B==="mp3"){s+='<source type="audio/mpeg" src="'+q+'" />';z+='type="audio/mpeg" src="'+q+'"></audio>'}}}s+="</audio>";if(i.isSafari){i.$overlayContent.append(z)}else{i.$overlayContent.append(innerShiv(s))}if(i.$window.width()<=480){i.overlayShow(i.$window.width()-80,30,l)}else{i.overlayShow(400,30,l)}}else{if(k==="video"){var y=600,w=338;if(i.$window.width()<=680){y=i.$window.width()-80;w=y*(338/600)}if(j.eq(0).text().indexOf("youtube")!==-1){var A=j.eq(0).text().split("v=")[1],x=i.autoplay?"&autoplay=1":"",o='<iframe width="'+y+'" height="'+w+'" src="http://www.youtube.com/embed/'+A+"?hd=1&rel=0&enablejsapi=1"+x+'" frameborder="0" allowfullscreen></iframe>',r=i.$overlayContent.append(o).find("iframe");i.thumbMeElem={pluginType:"youtube",pause:function(){r[0].contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*")}}}else{if(j.eq(0).text().indexOf("vimeo")!==-1){var A=j.eq(0).text().split("/").pop(),n=i.autoplay?"&autoplay=1":"",m="http://player.vimeo.com/video/"+A,o='<iframe src="'+m+"?api=1"+n+'" width="'+y+'" height="'+w+'" frameborder="0" webkitAllowFullScreen allowFullScreen></iframe>',r=i.$overlayContent.append(o).find("iframe");i.thumbMeElem={pluginType:"vimeo",pause:function(){r[0].contentWindow.postMessage('{"method":"pause"}',m)}}}else{var o='<video controls width="'+y+'" height="'+w+'">',u='<video controls width="'+y+'" height="'+w+'"';for(var t=0,v=j.length;t<v;t++){var q=j.eq(t).text(),B=q.split(".").pop();if(B==="mp4"){o+='<source type="video/mp4" src="'+q+'" />';u+='type="video/mp4" src="'+q+'"></video>'}else{if(B==="webm"){o+='<source type="video/webm" src="'+q+'" />'}else{if(B==="ogv"){o+='<source type="video/ogg" src="'+q+'" />'}}}}o+="</video>";if(i.isSafari){i.$overlayContent.append(u)}else{i.$overlayContent.append(innerShiv(o))}}}i.overlayShow(y,w,l)}}}})},overlayShow:function(h,k,l){var g=d,f=g.$thumbGrid.find("li.filtered").length;g.$overlay.css({display:"block",visibility:"hidden",width:h});g.$overlayContent.show();var e=g.$overlay.find("div.details").height()+20,j=-(k+e+40)/2,i=-(h+40)/2;g.$overlayContent.hide();if(g.thumbIndex===0){g.$prevItem.hide();g.$nextItem.show()}else{if(g.thumbIndex===f-1){g.$prevItem.show();g.$nextItem.hide()}else{g.$prevItem.show();g.$nextItem.show()}}g.$overlayLoader.hide();g.$overlay.css({display:"none",visibility:"visible",width:h,height:k+e,top:l,marginTop:j,marginLeft:i}).slideDown(600,function(){g.$overlayContent.fadeIn(400).find("audio,video").mediaelementplayer({audioWidth:h,videoWidth:h,videoHeight:k,hideVolumeOnTouchDevices:false,startVolume:g.storeVolume&&g.volume?g.volume:1,loop:g.loop,pauseOtherPlayers:false,mode:g.isChrome?"shim":"auto",success:function(m,n,o){g.thumbMeElem=m;g.thumbPlayer=o;g.html5FS&&o.media.pluginType==="native"&&o.container.find("div.mejs-fullscreen-button").off("click");if(g.ie9js){IE7.recalc()}if(g.autoplay){m.play()}}})})},overlayPrev:function(){var e=d;if(e.thumbIndex-1<0){return}if(e.thumbPlayer){e.thumbPlayer.remove()}e.$overlayContent.hide().children().not("div.details").remove();e.$overlay.hide();if(e.thumbMeElem){e.thumbMeElem=null;e.thumbPlayer=null;b.mejs.players=[]}e.$thumbGrid.find("li.filtered").eq(e.thumbIndex-1).children("a.showOverlay").trigger("click")},overlayNext:function(){var e=d;if(e.thumbIndex+1===e.itemnum){return}if(e.thumbPlayer){e.thumbPlayer.remove()}e.$overlayContent.hide().children().not("div.details").remove();e.$overlay.hide();if(e.thumbMeElem){e.thumbMeElem=null;e.thumbPlayer=null;b.mejs.players=[]}e.$thumbGrid.find("li.filtered").eq(e.thumbIndex+1).children("a.showOverlay").trigger("click")},overlayClose:function(){var e=d;e.$overlayContent.fadeOut(400,function(){e.$overlay.slideUp(600,function(){if(e.thumbPlayer){e.thumbPlayer.remove()}e.$overlayContent.children().not("div.details").remove();e.$mask.fadeOut(400);if(e.thumbMeElem){e.volume=e.thumbMeElem.volume;if(e.msie){e.thumbMeElem=null;e.thumbPlayer=null;b.mejs.players=[]}}})})},resizeImage:function(h,i){if(!h){return}var n=d,k=i==="thumbnails"?n.$window.width()-120:n.$fwmedia.width()-40,g=i==="thumbnails"?n.$window.height()-270:n.$fwmedia.height()-40,m=k/g,j=h.width/h.height,f=h.width,l=h.height;if(i==="fullwidth"){var e=c(h);e.addClass("getSize");if(n.msie){f=e.width();l=e.height();j=f/l}}if(i==="thumbnails"){k=k<0?n.$window.width()-40:k;if(g<50){n.$overlay.css({display:"block",visibility:"hidden"});n.$overlayContent.show();g=n.$window.height()-100-n.$overlay.find("div.details").height();n.$overlayContent.hide();n.$overlay.css({display:"none",visibility:"visible"})}}if(i==="fullwidth"&&n.$fwmedia.data("type")==="audio"){g=n.$fwmedia.height()-70}if(f>k||l>g){if(j===m){f=k;l=g}else{f=g*j;l=g;if(f>k){f=k;l=k/j}}}h.width=f;h.height=l;if(i==="fullwidth"){if(n.$fwmedia.data("type")==="audio"){e.removeClass("getSize").css({left:(n.$fwmedia.width()-f)/2,top:(n.$fwmedia.height()-30-l)/2})}else{e.removeClass("getSize").css({left:(n.$fwmedia.width()-f)/2,top:(n.$fwmedia.height()-l)/2})}}},setFWItem:function(n){if(n&&n.originalEvent&&d.fwClock){d.resetSlideshow()}var s=d,r=c(this),l=s.$fullGallery.find("li.filtered"),q=l.length,k=l.index(this),j=r.data("id"),p=r.data("type"),g=s.$files.eq(j),f=g.find("source"),h=s.$fullGallery.find("div.bottom-bar"),i=null,m;s.fwIndex=k;s.$fwActiveItem=r;r.addClass("active").siblings().removeClass("active");s.fwMeElem&&(s.volume=s.fwMeElem.volume)&&s.fwMeElem.pause();if(k===0){s.$fullGallery.find("a.prev").addClass("disabled");s.$fullGallery.find("a.next").removeClass("disabled")}else{if(k===q-1){s.$fullGallery.find("a.prev").removeClass("disabled");s.$fullGallery.find("a.next").addClass("disabled")}else{s.$fullGallery.find("a.prev").removeClass("disabled");s.$fullGallery.find("a.next").removeClass("disabled")}}h.find("p.slide-number").text((k+1)+"/"+q);h.find("p.title").html(g.find("title").text());if(s.$fwOverlay.is(":visible")){s.closeFWCaption()}s.$fwmedia.data("type",p);s.$fullGallery.find("p.title").attr("data-type",p);var o=function(){s.$fwmedia.empty();b.mejs.players=[];s.fwMeElem=null;s.fwplayer=null;if(p==="photo"){i=new Image;i.src=f.text();s.$fwmedia.append(i);m=function(){if(s.$fullGallery.find("a.resize").hasClass("collapsed")){s.resizeImage(s.$fwmedia.find("img")[0],"fullwidth")}else{s.setFullMediaSize()}s.showFWMedia()}}else{if(p==="audio"){i=new Image;i.src=g.find("poster").text();s.$fwmedia.append(i);m=function(){if(s.$fullGallery.find("a.resize").hasClass("collapsed")){s.resizeImage(s.$fwmedia.find("img")[0],"fullwidth")}else{s.setFullMediaSize()}s.showFWMedia()};var z='<audio controls width="100%">',F='<audio controls width="100%"';for(var A=0,C=f.length;A<C;A++){var w=f.eq(A).text(),I=w.split(".").pop();if(I==="ogg"){z+='<source type="audio/ogg" src="'+w+'" />'}else{if(I==="mp3"){z+='<source type="audio/mpeg" src="'+w+'" />';F+='type="audio/mpeg" src="'+w+'"></audio>'}}}z+="</audio>";s.isSafari?s.$fwmedia.append(F):s.$fwmedia.append(z);s.setFWPlayer()}else{if(p==="video"){if(f.eq(0).text().indexOf("youtube")!==-1){var H=f.eq(0).text().split("v=")[1],E=s.autoplay?"&autoplay=0":"",u='<iframe width="640" height="360" src="http://www.youtube.com/embed/'+H+"?hd=1&rel=0&enablejsapi=1&wmode=transparent"+E+'" frameborder="0" allowfullscreen></iframe>',y=s.$fwmedia.append(u).find("iframe");s.fwMeElem={pluginType:"youtube",pause:function(){y[0].contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*")}};s.fwplayer={container:y};s.showFWMedia();if(s.$fullGallery.find("a.resize").hasClass("collapsed")){s.shrinkVideo()}else{s.setFullMediaSize()}}else{if(f.eq(0).text().indexOf("vimeo")!==-1){var H=f.eq(0).text().split("/").pop(),t=s.autoplay?"&autoplay=0":"",u='<iframe src="http://player.vimeo.com/video/'+H+"?api=1&wmode=transparent"+t+'" width="640" height="360" frameborder="0" webkitAllowFullScreen allowFullScreen></iframe>',e="http://player.vimeo.com/video/"+H,y=s.$fwmedia.append(u).find("iframe");s.fwMeElem={pluginType:"vimeo",pause:function(){y[0].contentWindow.postMessage('{"method":"pause"}',e)}};s.fwplayer={container:y};s.showFWMedia();if(s.$fullGallery.find("a.resize").hasClass("collapsed")){s.shrinkVideo()}else{s.setFullMediaSize()}}else{var x=g.find("poster"),v=x.length!==0?' poster="'+x.text()+'"':"",u='<video preload="metadata"'+v+">",B='<video preload="metadata"'+v+" ";for(var A=0,C=f.length;A<C;A++){var w=f.eq(A).text(),I=w.split(".").pop();if(I==="mp4"){u+='<source type="video/mp4" src="'+w+'" />';B+='type="video/mp4" src="'+w+'"></video>'}else{if(I==="webm"){u+='<source type="video/webm" src="'+w+'" />'}else{if(I==="ogv"){u+='<source type="video/ogg" src="'+w+'" />'}}}}u+="</video>";s.isSafari?s.$fwmedia.append(B):s.$fwmedia.append(u);s.$fullGallery.addClass("loading");s.setFWPlayer()}}}}}if(i&&p!=="video"){if(i.complete||i.readyState==="complete"||i.readyState===4){m()}else{s.$fullGallery.addClass("loading");i.onload=function(){m();s.$fullGallery.removeClass("loading")}}var D=g.find("link").text(),G="";if(D){if(s.options.newWindowLinks){G='<a class="link" href="'+D+'" target="_blank"></a>'}else{G='<a class="link" href="'+D+'"></a>'}s.$fwmedia.append(G)}}s.preloadImgs()};s.fwItemTransition(o)},fwItemTransition:function(f){var e=d;if(e.options.fullwidthItemTransition==="flip"&&Modernizr.csstransforms3d){e.$fwmedia.css({transformOrigin:"center center"}).transition({scale:0.5,opacity:0},e.fwmediaSpeed,e.easing,f)}else{if(e.options.fullwidthItemTransition==="slide"&&Modernizr.csstransitions){e.$fwmedia.transition({x:-e.$fwmedia.width()},e.fwmediaSpeed,e.easing,f)}else{e.$fwmedia.animate({opacity:0},e.fwmediaSpeed,f)}}},showFWMedia:function(){var e=d;if(e.options.fullwidthItemTransition==="flip"&&Modernizr.csstransforms3d){e.$fwmedia.css({opacity:1,transform:"scale(0.5) rotateX(90deg)",transformOrigin:"center 75%"}).transition({perspective:"600px",rotateX:"0deg",scale:1},e.fwmediaSpeed*2,e.easing)}else{if(e.options.fullwidthItemTransition==="slide"&&Modernizr.csstransitions){e.$fwmedia.css({x:e.$fwmedia.width()}).transition({x:0},e.fwmediaSpeed,e.easing)}else{e.$fwmedia.animate({opacity:1},e.fwmediaSpeed)}}},setFWPlayer:function(){var e=d,f;if(e.isChrome){f="shim"}else{if(e.isIE9&&e.$fwmedia.data("type")==="video"){f="shim"}else{f="auto"}}e.$fullGallery.find("audio,video").mediaelementplayer({hideVolumeOnTouchDevices:e.isAndroid?true:false,startVolume:e.storeVolume&&e.volume?e.volume:1,loop:e.loop,pauseOtherPlayers:false,mode:f,success:function(i,h,g){e.fwMeElem=i;e.fwplayer=g;if(e.ie9js){IE7.recalc()}if(i.tagName.toLowerCase()==="video"){if(e.isiOS||e.isAndroid){e.$fullGallery.removeClass("loading");e.showFWMedia();if(e.$fullGallery.find("a.resize").hasClass("collapsed")){e.shrinkVideo()}else{e.setFullMediaSize()}g.container.css("opacity","1").find("div.mejs-poster").css("opacity","1")}else{i.addEventListener("loadedmetadata",function(){e.$fullGallery.removeClass("loading");e.showFWMedia();if(e.$fullGallery.find("a.resize").hasClass("collapsed")){e.shrinkVideo()}else{e.setFullMediaSize()}g.container.css("opacity","1");g.media.pluginType!=="native"&&g.container.find("div.mejs-poster").css("opacity","1")},false)}(e.html5FS||e.isOpera)&&g.media.pluginType==="native"&&g.container.find("div.mejs-fullscreen-button").off("click")}}})},setFullwidthSize:function(){var e=d,f=e.$fwmedia.data("type"),h=e.$fullGallery.find("p.title"),g=e.displayType==="container"?e.$novaGallery.parent():e.$window;if(a.fullScreenElement||a.mozFullScreenElement||a.webkitIsFullScreen){g=e.$window}h.css({width:h.parent().width()-h.prev().outerWidth(true)-h.next().outerWidth(true)-parseInt(h.css("margin-left"),10)-20});e.$fullGallery.css({height:g.height()-e.$novaGallery.find("menu").height()});e.$fwmedia.height(e.$fullGallery.height()-e.$fullGallery.find("div.fwBottom").height());f!=="photo"&&!e.fwplayer&&e.setFWPlayer();e.setThumbnailsSlider();if(e.$fullGallery.find("a.resize").hasClass("collapsed")){if(f==="video"){e.shrinkVideo()}else{e.resizeImage(e.$fwmedia.find("img")[0],"fullwidth")}}else{e.setFullMediaSize()}},showFullwidthThumbs:function(){var f=d,k=f.$fwmedia.data("type")==="video"?true:false,e=f.$fullGallery.find("a.resize").hasClass("collapsed"),g=f.$fwmedia.find("img"),h=k&&(f.fwMeElem.pluginType==="flash"||f.fwMeElem.pluginType==="youtube"||f.fwMeElem.pluginType==="vimeo")?true:false;if(c(this).hasClass("active")){f.$fwmedia.animate({height:f.$fullGallery.height()-f.$fullGallery.find("div.bottom-bar").height()},{duration:600,step:function(l){if(!h){if(e){f.resizeImage(g[0],"fullwidth")}else{f.setFullMediaSize()}}},complete:function(){if(h){if(e){f.shrinkVideo()}else{f.setFullMediaSize()}}}});f.$fullGallery.find("div.thumbnails").transition({height:0},600,f.easing);c(this).removeClass("active")}else{var j=f.$fullGallery.find("li").height(),i=f.$fullGallery.find("div.bottom-bar").height();f.$fullGallery.find("div.thumbnails").transition({height:j},600,f.easing);f.$fwmedia.animate({height:f.$fullGallery.height()-j-i},{duration:600,step:function(l){if(!h){if(e){f.resizeImage(g[0],"fullwidth")}else{f.setFullMediaSize()}}},complete:function(){if(h){if(e){f.shrinkVideo()}else{f.setFullMediaSize()}}}});c(this).addClass("active")}},setFullMediaSize:function(){var k=d,l=k.$fwmedia.data("type"),j=k.$fwmedia.width(),g=k.$fwmedia.height(),f,e,m,i;if(l==="video"&&k.fwMeElem){i=!k.fwMeElem.videoWidth||k.fwMeElem.videoWidth===-1?640/360:k.fwMeElem.videoWidth/k.fwMeElem.videoHeight}else{f=k.$fwmedia.find("img");if(f.length===0){return}i=f[0].width/f[0].height}if(j/g<i){e=g*i;m=g}else{e=j;m=j/i}if(l==="video"&&k.fwMeElem){if(k.fwMeElem.pluginType==="youtube"||k.fwMeElem.pluginType==="vimeo"){k.fwplayer.container.attr({width:j,height:g})}else{k.fwMeElem.setVideoSize(e,m);k.fwplayer.setPlayerSize(j,g)}if(k.fwMeElem.pluginType!=="native"||k.isiOS||k.isAndroid){var h=k.$fwmedia.find("div.mejs-poster img");if(h.length!==0){h.css({width:e,height:"auto"}).parent().css("line-height","")}k.fwplayer.container.css({top:"auto",left:"auto"})}else{k.$fwmedia.find("div.mejs-mediaelement").css({top:(g-m)/2,left:(j-e)/2})}}else{f[0].width=e;f[0].height=m;f.css({left:(j-e)/2,top:(g-m)/2})}k.fwplayer&&k.fwplayer.setControlsSize&&k.fwplayer.setControlsSize()},showNextFWItem:function(h){if(h&&h.originalEvent&&d.fwClock){d.resetSlideshow()}var m=d,g=m.$fullGallery.find("li.filtered"),j=g.length,l=m.$fullGallery.width()-2*m.$fullGallery.find("a.slide-next").width(),i=g.width(),f=Math.floor(l/i),n,k;if(m.fwIndex===j-1){return}n=Math.floor(m.fwIndex/f);k=Math.floor((m.fwIndex+1)/f);n!==k&&m.$fullGallery.find("a.slide-next").trigger("click");g.eq(m.fwIndex+1).trigger("click")},showPrevFWItem:function(i){if(i&&i.originalEvent&&d.fwClock){d.resetSlideshow()}var m=d,h=m.$fullGallery.find("li.filtered"),l=m.$fullGallery.width()-2*m.$fullGallery.find("a.slide-next").width(),j=h.width(),g=Math.floor(l/j),f,n,k;if(m.fwIndex===0){return}n=Math.floor(m.fwIndex/g);k=Math.floor((m.fwIndex-1)/g);n!==k&&m.$fullGallery.find("a.slide-prev").trigger("click");h.eq(m.fwIndex-1).trigger("click")},FWSlideshow:function(){var f=d,g=c(this),e=f.$fullGallery.find("div.progress").stop().css("width","0");if(f.fwClock){clearInterval(f.fwClock);f.fwClock=null;g.removeClass("pause")}else{e.animate({width:"100%"},f.pauseTime+f.fwmediaSpeed,"linear");f.fwClock=setInterval(function(){var i=f.$fullGallery.find("li.filtered"),h=i.length;if(f.fwIndex===h-1){i.eq(0).trigger("click");i.eq(0).transition({marginLeft:0},600);i.parent().prev("a.slide-prev").addClass("disabled").end().next("a.slide-next").removeClass("disabled")}else{f.showNextFWItem()}e.stop().css("width","0").animate({width:"100%"},f.pauseTime+f.fwmediaSpeed,"linear")},f.pauseTime+f.fwmediaSpeed);g.addClass("pause")}},resetSlideshow:function(){var e=d;if(e.fwClock){clearInterval(e.fwClock);e.fwClock=null;e.FWSlideshow()}},resizeFWItem:function(){var e=d,f=e.$fullGallery.find("a.resize");if(f.hasClass("collapsed")){e.setFullMediaSize();f.removeClass("collapsed")}else{if(e.$fwmedia.data("type")==="video"){e.shrinkVideo()}else{e.resizeImage(e.$fwmedia.find("img")[0],"fullwidth")}f.addClass("collapsed")}},shrinkVideo:function(){if(!d.fwMeElem){return}var g=d,l=g.$fwmedia.width(),h=g.$fwmedia.height(),i=l/h,j=g.fwMeElem.videoWidth===-1||!g.fwMeElem.videoWidth?640:g.fwMeElem.videoWidth,k=g.fwMeElem.videoHeight===-1||!g.fwMeElem.videoHeight?360:g.fwMeElem.videoHeight,e=j/k;if(j>l||k>h){if(e===i){j=l;k=h}else{j=h*e;k=h;if(j>l){j=l;k=l/e}}}var f=g.$fwmedia.find("div.mejs-poster img");if(g.fwMeElem.pluginType!=="native"||g.isiOS||g.isAndroid){if(g.fwMeElem.pluginType==="youtube"||g.fwMeElem.pluginType==="vimeo"){g.fwplayer.container.attr({width:j,height:k})}else{g.fwMeElem.setVideoSize(j,k);g.fwplayer.setPlayerSize(j,k);g.fwplayer.setControlsSize()}if(f.length!==0){f.css({width:j,height:"auto"}).parent().css("line-height",k+"px")}g.fwplayer.container.css({top:(h-k)/2,left:(l-j)/2})}else{g.fwMeElem.setVideoSize(j,k);g.fwplayer.setPlayerSize(l,h);g.fwplayer.setControlsSize();g.$fwmedia.find("div.mejs-mediaelement").css({top:(h-k)/2,left:(l-j)/2})}},showFWCaption:function(){var g=d,i=g.$fwActiveItem.data("id"),f=g.$files.eq(i),l=g.options.displayType==="container"?g.$novaGallery.parent():g.$window,h,e,k,j;if(g.$fwOverlay.is(":visible")){return}g.$fwOverlayContent.html("<h2></h2><p></p>").find("h2").html(f.find("title").text()).end().find("p").html(f.find("description").text());g.$fwOverlay.addClass("hidden");g.$fwOverlayContent.css("max-height",l.height()-g.$fwOverlayContent.outerHeight(true)-100);h=g.$fwOverlay.outerWidth();e=g.$fwOverlay.outerHeight();g.$fwOverlay.removeClass("hidden");k=g.$fwmedia.height()/2-e/2;j=g.$fwmedia.width()/2-h/2;g.$fwOverlay.css({top:k-100,left:j,display:"block",opacity:0}).transition({top:k,opacity:1},600,g.easing)},closeFWCaption:function(){var e=d;e.$fwOverlay.transition({top:"-=100px",opacity:0},600,e.easing,function(){e.$fwOverlay.hide();e.$fwOverlayContent.empty()})},setThumbnailsSlider:function(){var m=d,h=m.$fullGallery.find("ul"),i=h.find("li.filtered"),k=i.length,l=m.$fullGallery.width()-2*m.$fullGallery.find("a.slide-next").width(),j=i.width(),g,n=i.index(i.filter("li.active")),f=0,e=0;g=Math.floor(l/j);f=-Math.floor((n+1)/g)*j*g;e=Math.ceil(k/g);h.width(j*g);h.data("slides",e);i.eq(0).css("margin-left",f);if(f===0){h.prev("a.slide-prev").addClass("disabled");h.next("a.slide-next").removeClass("disabled")}else{if(f===-e*h.width()){h.prev("a.slide-prev").removeClass("disabled");h.next("a.slide-next").addClass("disabled")}else{h.prev("a.slide-prev").removeClass("disabled");h.next("a.slide-next").removeClass("disabled")}}e===1?h.addClass("centerItems").next("a.slide-next").addClass("disabled"):h.removeClass("centerItems")},thumbnailsSlideNext:function(){var f=d,e=c(this),g=f.$fullGallery.find("ul"),h=g.find("li.filtered");if(e.hasClass("disabled")){return}else{e.siblings("a.slide-prev").removeClass("disabled");h.eq(0).transition({marginLeft:"-="+g.width()},600,f.easing,function(){if(parseInt(h.eq(0).css("margin-left"),10)===-(g.data("slides")-1)*g.width()){e.addClass("disabled")}})}},thumbnailsSlidePrev:function(){var f=d,e=c(this),g=f.$fullGallery.find("ul"),h=g.find("li.filtered");if(e.hasClass("disabled")){return}else{e.siblings("a.slide-next").removeClass("disabled");h.eq(0).transition({marginLeft:"+="+g.width()},600,f.easing,function(){if(parseInt(h.eq(0).css("margin-left"),10)===0){e.addClass("disabled")}})}},touchSlide:function(g){var f=d;if(g.type==="touchstart"){f.touchStartPos=g.originalEvent.touches[0].pageX}else{if(g.type==="touchmove"){g.preventDefault();f.touchEndPos=g.originalEvent.touches[0].pageX}else{if(g.type==="touchend"){if(!f.touchEndPos){return}if(f.touchEndPos-f.touchStartPos>=100){f.$fullGallery.find("a.slide-prev").trigger("click")}else{if(f.touchEndPos-f.touchStartPos<=-100){f.$fullGallery.find("a.slide-next").trigger("click")}}f.touchEndPos=null}}}},preloadImgs:function(){var g=d,e=g.$fwActiveItem.data("id"),j=g.$files.eq(e),m=j.next(),l="",h=g.preloadNumber?g.preloadNumber:3;for(var k=0;k<h;k++){var f=new Image;l=m.attr("type");if(l==="photo"){f.src=m.find("source").text()}else{if(l==="audio"){f.src=m.find("poster").text()}else{if(l==="video"){f.src=m.find("poster").text()}}}m=m.next()}},handleKeys:function(h){var g=h.keyCode||h.charCode,f=d;if(f.$fullGallery.is(":visible")){if(g===39){f.fwClock&&f.resetSlideshow();f.showNextFWItem()}else{if(g===37){f.fwClock&&f.resetSlideshow();f.showPrevFWItem()}else{if(g===27){f.closeFWCaption()}}}}else{if(f.$thumbGrid.is(":visible")){if(g===39){f.overlayNext()}else{if(g===37){f.overlayPrev()}else{if(g===27){f.overlayClose()}}}}}},operaMEFS:function(){var e=d;if(e.fwplayer.media.pluginType==="native"){if(e.fwplayer.container.hasClass("mejs-container-fullscreen")){e.fwplayer.container.removeClass("mejs-container-fullscreen");c(this).addClass("mejs-fullscreen").removeClass("mejs-unfullscreen");e.$fullGallery.css("overflow","hidden");e.$fwmedia.css("overflow","hidden")}else{e.fwplayer.container.addClass("mejs-container-fullscreen");c(this).removeClass("mejs-fullscreen").addClass("mejs-unfullscreen");e.$fullGallery.css("overflow","visible");e.$fwmedia.css("overflow","visible")}}},operaEscPlayerFS:function(h){var g=h.keyCode||h.charCode,f=d;if(g===27&&f.fwplayer.media.pluginType==="native"&&f.fwplayer.container.hasClass("mejs-container-fullscreen")){f.fwplayer.container.removeClass("mejs-container-fullscreen").find("div.mejs-fullscreen-button").addClass("mejs-fullscreen").removeClass("mejs-unfullscreen");f.$fullGallery.find("div.fwBottom").show();f.$novaGallery.find("menu").show();f.$fullGallery.css("overflow","hidden");f.$fwmedia.css("overflow","hidden")}},nativeMEFS:function(){var e=d,f=a.fullScreenElement?a.fullScreenElement:a.mozFullScreenElement?a.mozFullScreenElement:a.webkitFullScreenElement?a.webkitFullScreenElement:null,g=e.$thumbGrid.is(":visible")?"thumbnails":"fullwidth";if(!f){g==="thumbnails"?e.thumbPlayer.enterFullScreen():e.fwplayer.enterFullScreen()}else{if(c(f).hasClass("mejs-video")){g==="thumbnails"?e.thumbPlayer.exitFullScreen():e.fwplayer.exitFullScreen()}else{g==="thumbnails"?e.thumbPlayer.enterFullScreen():e.fwplayer.enterFullScreen()}}},getHiddenProp:function(){var f=["webkit","moz","ms","o"];if("hidden" in a){return"hidden"}for(var e=0;e<f.length;e++){if((f[e]+"Hidden") in a){return f[e]+"Hidden"}}return null},isPageHidden:function(){var e=d.getHiddenProp();if(!e){return false}return a[e]},pageVisChange:function(){var e=d;if(e.isPageHidden()){if(e.fwClock){clearInterval(e.fwClock);e.fwClock=null;e.$fullGallery.find("a.slideshow").removeClass("pause");e.$fullGallery.find("div.progress").stop().css("width","0")}if(e.fwMeElem){e.fwMeElem.pause()}if(e.thumbMeElem){e.thumbMeElem.pause()}}},ngLog:function(){if(b.console&&b.console.log){console.log("[novaGallery] "+Array.prototype.slice.call(arguments))}else{alert("[novaGallery] "+Array.prototype.slice.call(arguments).join("<br>"))}}};c.novaGallery=function(f){d.options=c.extend(true,{},c.novaGallery.defaults,f);var h=c("#novaGallery"),g=d.options;if(!c.data(h[0],"novaGallery")){c.data(h[0],"novaGallery",true);if(g.flickr){c("#filterButtons").hide();if(g.flickrOptions.sourceType==="collection"){d.loadFlickrCollection(g.flickrOptions)}else{d.loadFlickrData(g.flickrOptions)}}else{if(g.picasa){c("#filterButtons").hide();d.loadPicasaData(g.picasaOptions)}else{var e=g.configUrl;if(g.detectMobile){c.ajax({type:"GET",url:"includes/mobile.php",dataType:"text",success:function(i){if(i==="true"){e=g.mobileConfigUrl}d.loadConfig(e)}})}else{d.loadConfig(e)}}}}};c.novaGallery.defaults={autoplay:true,loop:false,storeVolume:true,startMode:"thumbnails",fullwidthResize:false,showFullwidthThumbs:true,thumbnailsAppearAnimation:"fadeSeq",thumbnailsCaptionAnimation:"flip",fullwidthItemTransition:"fade",homescreenAnimation:"scale",displayType:"window",newWindowLinks:true,useYoutubeThumbs:true,useVimeoThumbs:true,shuffleItems:true,preloadNumber:5,slideshow:false,pauseTime:5000,configUrl:"config.xml",detectMobile:false,mobileConfigUrl:"config-mobile.xml",enableCache:true,cacheFolder:"cache",cacheInterval:10,flickr:false,flickrOptions:{apiKey:"",sourceType:"text",sourceId:"",userId:"",limit:30,sort:"relevance",thumbSize:"s",imageSize:"l"},picasa:false,picasaOptions:{sourceType:"search",username:"",album:"",search:"",limit:30,thumbSize:288,imageSize:1280}};c.fn.redraw=function(){return this.each(function(){var e=this.offsetHeight})}})(jQuery,document,window);